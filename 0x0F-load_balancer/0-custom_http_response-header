#!/usr/bin/env bash

# Update Nginx package lists
sudo apt-get update

# Check if Nginx is already installed (informative)
if [[ $(dpkg-query -l nginx | grep installed) ]]; then
  echo "Nginx is already installed."
else
  # Install Nginx if not present
  sudo apt-get install -y nginx
fi

# Add custom response header (X-Served-By)
sudo sed -i "/server_name _/a add_header X-Served-By $HOSTNAME;" /etc/nginx/sites-enabled/default

# Test Nginx configuration for errors
sudo nginx -t

# Check systemd availability (use appropriate restart command)
if systemctl status systemd &> /dev/null; then
  sudo systemctl restart nginx
else
  sudo service nginx restart
fi
